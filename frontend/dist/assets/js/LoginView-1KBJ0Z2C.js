var f=(y,m,a)=>new Promise((p,d)=>{var v=n=>{try{l(a.next(n))}catch(o){d(o)}},r=n=>{try{l(a.throw(n))}catch(o){d(o)}},l=n=>n.done?p(n.value):Promise.resolve(n.value).then(v,r);l((a=a.apply(y,m)).next())});import{d as V,o as x,a as w,c as i,b as t,e as B,t as b,w as S,f as h,v as g,g as _,h as C,u as I,r as c,i as u,_ as M,j as N}from"./index-jq79V9PP.js";const q={class:"login-page"},D={class:"login-card"},L={class:"login-hint"},P={class:"field"},U=["placeholder"],T={class:"field"},j=["placeholder","autocomplete"],A={key:0,class:"field"},E={key:1,class:"password-rules"},R={key:2,class:"error-box",role:"alert"},z=["disabled"],F={key:0,class:"spinner"},G={class:"login-footer"},H={key:0},J={key:1},K=V({__name:"LoginView",setup(y){const m=I(),a=c(!1),p=c(""),d=c(""),v=c(""),r=c(""),l=c(!1);x(()=>f(this,null,function*(){try{const{data:o}=yield w.get("/api/auth/status");if(o.authenticated){m.replace("/");return}a.value=!o.auth_enabled}catch(o){}}));function n(){return f(this,null,function*(){var o,e;r.value="",l.value=!0;try{if(a.value){if(d.value!==v.value){r.value="两次输入的密码不一致";return}const{data:s}=yield w.post("/api/auth/setup",{username:p.value,password:d.value});s.token&&localStorage.setItem("CountBot_token",s.token)}else{const{data:s}=yield w.post("/api/auth/login",{username:p.value,password:d.value});s.token&&localStorage.setItem("CountBot_token",s.token)}m.replace("/")}catch(s){const k=(e=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:e.detail;r.value=k||"操作失败，请重试"}finally{l.value=!1}})}return(o,e)=>(u(),i("div",q,[t("div",D,[e[6]||(e[6]=B('<div class="login-brand" data-v-e02d2553><div class="brand-icon" data-v-e02d2553><img src="'+M+'" alt="CountBot Logo" data-v-e02d2553></div><h1 class="brand-name" data-v-e02d2553><span class="brand-count" data-v-e02d2553>Count</span><span class="brand-bot" data-v-e02d2553>Bot</span></h1><p class="brand-tagline" data-v-e02d2553>654321, AI Delivers</p></div>',1)),t("p",L,b(a.value?"首次远程访问，请设置管理员账号和密码":"远程访问需要身份验证"),1),t("form",{onSubmit:S(n,["prevent"]),class:"login-form",autocomplete:"on"},[t("div",P,[e[3]||(e[3]=t("label",{for:"username"},"账号",-1)),h(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),type:"text",placeholder:a.value?"设置管理员账号":"请输入账号",autocomplete:"username",required:""},null,8,U),[[g,p.value]])]),t("div",T,[e[4]||(e[4]=t("label",{for:"password"},"密码",-1)),h(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),type:"password",placeholder:a.value?"设置密码":"请输入密码",autocomplete:a.value?"new-password":"current-password",required:""},null,8,j),[[g,d.value]])]),a.value?(u(),i("div",A,[e[5]||(e[5]=t("label",{for:"confirmPassword"},"确认密码",-1)),h(t("input",{id:"confirmPassword","onUpdate:modelValue":e[2]||(e[2]=s=>v.value=s),type:"password",placeholder:"再次输入密码",autocomplete:"new-password",required:""},null,512),[[g,v.value]])])):_("",!0),a.value?(u(),i("div",E," 密码要求：至少 8 位，必须同时包含大写字母、小写字母和数字 ")):_("",!0),r.value?(u(),i("div",R,b(r.value),1)):_("",!0),t("button",{type:"submit",class:"submit-btn",disabled:l.value},[l.value?(u(),i("span",F)):_("",!0),C(" "+b(l.value?"请稍候...":a.value?"设置并登录":"登录"),1)],8,z)],32),t("div",G,[a.value?(u(),i("span",J,"设置完成后将自动登录")):(u(),i("span",H,"密码要求：至少 8 位，包含大写字母、小写字母和数字"))])])]))}}),W=N(K,[["__scopeId","data-v-e02d2553"]]);export{W as default};
